<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Intro The problem of sampling uniformly in the space of 3D rotations arises commonly in the field of robotics, computer vision, compute graphics etc. The problem is, how do we define &ldquo;uniform&rdquo; in the context of rotations?\nNaive solution A naive method would be sampling the unit rotation axis and the geodesic rotation magnitude separately, both uniformly on $\\mathbb{S}^2$ (i.e. The 2-D sphere of a 3-D ball) and $[0, \\pi]$. This will not give a uniform distribution, as there&rsquo;s a straight forward intuition that is violated by this method. The intuition is that, a rotation of zero rotation angle should have zero probability (or measure) in our desired distribution. At tiny angles, there&rsquo;s not much space for the rotation, beside a little wiggle. As the rotation angle increases, so does the probability of it.\n"><title>Uniform sampling of SO(3) rotations</title><link rel=canonical href=https://kya8.github.io/p/uniform-sampling-of-so3-rotations/><link rel=stylesheet href=/scss/style.min.8659d82dbe8d0fe183ef22445ed42765c7d1d996ae5b4a02725eda69426286da.css><meta property='og:title' content="Uniform sampling of SO(3) rotations"><meta property='og:description' content="Intro The problem of sampling uniformly in the space of 3D rotations arises commonly in the field of robotics, computer vision, compute graphics etc. The problem is, how do we define &ldquo;uniform&rdquo; in the context of rotations?\nNaive solution A naive method would be sampling the unit rotation axis and the geodesic rotation magnitude separately, both uniformly on $\\mathbb{S}^2$ (i.e. The 2-D sphere of a 3-D ball) and $[0, \\pi]$. This will not give a uniform distribution, as there&rsquo;s a straight forward intuition that is violated by this method. The intuition is that, a rotation of zero rotation angle should have zero probability (or measure) in our desired distribution. At tiny angles, there&rsquo;s not much space for the rotation, beside a little wiggle. As the rotation angle increases, so does the probability of it.\n"><meta property='og:url' content='https://kya8.github.io/p/uniform-sampling-of-so3-rotations/'><meta property='og:site_name' content="Kya's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='geometry'><meta property='article:tag' content='math'><meta property='article:published_time' content='2024-07-08T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-08T00:00:00+00:00'><meta name=twitter:title content="Uniform sampling of SO(3) rotations"><meta name=twitter:description content="Intro The problem of sampling uniformly in the space of 3D rotations arises commonly in the field of robotics, computer vision, compute graphics etc. The problem is, how do we define &ldquo;uniform&rdquo; in the context of rotations?\nNaive solution A naive method would be sampling the unit rotation axis and the geodesic rotation magnitude separately, both uniformly on $\\mathbb{S}^2$ (i.e. The 2-D sphere of a 3-D ball) and $[0, \\pi]$. This will not give a uniform distribution, as there&rsquo;s a straight forward intuition that is violated by this method. The intuition is that, a rotation of zero rotation angle should have zero probability (or measure) in our desired distribution. At tiny angles, there&rsquo;s not much space for the rotation, beside a little wiggle. As the rotation angle increases, so does the probability of it.\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>Kya's Blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/kya8 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#intro>Intro</a><ol><li><a href=#naive-solution>Naive solution</a></li></ol></li><li><a href=#the-haar-measure>The Haar measure</a><ol><li><a href=#uniform-sampling-on-a-unit-hypersphere>Uniform sampling on a unit hypersphere</a></li><li><a href=#parametric-sampling-on-the-hypersphere-hopf-fibration>Parametric sampling on the hypersphere (Hopf fibration).</a></li></ol></li><li><a href=#library-implementations>Library implementations</a></li><li><a href=#related-problem-uniform-sampling-inside-unit-ball>Related problem: Uniform sampling inside unit ball</a></li><li><a href=#references>References</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/math/>Math</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/uniform-sampling-of-so3-rotations/>Uniform sampling of SO(3) rotations</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 08, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><h1 id=intro>Intro</h1><p>The problem of sampling uniformly in the space of 3D rotations arises commonly in the field of robotics, computer vision, compute graphics etc.
The problem is, how do we define &ldquo;uniform&rdquo; in the context of rotations?</p><h2 id=naive-solution>Naive solution</h2><p>A naive method would be sampling the unit rotation axis and the geodesic rotation magnitude separately, both uniformly on $\mathbb{S}^2$ (i.e. The 2-D sphere of a 3-D ball) and $[0, \pi]$.
This will not give a uniform distribution, as there&rsquo;s a straight forward intuition that is
violated by this method.
The intuition is that, a rotation of zero rotation angle should have zero probability (or measure)
in our desired distribution.
At tiny angles, there&rsquo;s not much space for the rotation, beside a little wiggle.
As the rotation angle increases, so does the probability of it.</p><p>However, this naive solution would yield equal probability for all rotation angles, violating our intuition.</p><h1 id=the-haar-measure>The Haar measure</h1><p>Actually, to sample uniformly over a Lie group such as $SO(3)$, the probability density must correspond to the Haar measure, which represents a uniform distribution of the $SO(3)$ group.</p><p>As we know it, the $SU(2)$ group (or equivalently, all unit quaternions, or the $\mathbb{S}^3$ hypersphere) forms a proper <em>double cover</em>
over $SO(3)$.
The $SO(3)$ group space is kind of tricky, since it&rsquo;s not simply connected, with a non-trivia loop
of $2\pi$ rotation. The double cover given by unit quaternions unwraps it into a smooth hypersphere,
which is simply connected, and it&rsquo;s volume-preserving.</p><p>(Side note: This intrinsic property of $SO(3)$ gives rise to a interesting phenomenon,
where a $2\pi$ rotation is not equivalent to no rotation, but a $4\pi$ rotation is.
This is demonstrated by the <a class=link href=https://en.wikipedia.org/wiki/Plate_trick target=_blank rel=noopener>Dirac&rsquo;s string trick</a>)</p><p>This means we can simply sample uniformly on the space of unit quaternions,
which is also the $\mathbb{S}^3$ hypersphere. It&rsquo;s equivalent to the origin problem.</p><h2 id=uniform-sampling-on-a-unit-hypersphere>Uniform sampling on a unit hypersphere</h2><p>The problem now has turned into sampling on the $\mathbb{S}^3$ hypersphere.
A straight forward solution would be sampling from a direction-independent distribution,
then normalizing the radius.</p><p>A common approach is to sample each coordinate from independent but identical Gaussian distributions.
The probability density would be the product of each Gaussian distribution, which is only
determined by the radius $r$.
$$
P(\mathbf{x}) = \prod_{i}{\frac{1}{\sqrt{2\pi}} \exp(-\frac{x_i^2}{2})} \propto \exp(-\frac{r^2}{2})
$$
Afterwards, we normalize this vector, to bring it onto the unit sphere, and interpret it as a unit quaternion, mapping it to a 3D rotation.</p><p>To see if this distribution aligns with our intuition, we look at it&rsquo;s distribution w.r.t. rotational
magnitude:</p><p><img src=/p/uniform-sampling-of-so3-rotations/magnitude-hist.png width=578 height=435 srcset="/p/uniform-sampling-of-so3-rotations/magnitude-hist_hu_884ad7936e86e46b.png 480w, /p/uniform-sampling-of-so3-rotations/magnitude-hist_hu_5c8181b10690397.png 1024w" loading=lazy alt="Magnitude histogram" class=gallery-image data-flex-grow=132 data-flex-basis=318px></p><p>Looks like it does.</p><h2 id=parametric-sampling-on-the-hypersphere-hopf-fibration>Parametric sampling on the hypersphere (Hopf fibration).</h2><p>There&rsquo;s a another clever way of uniform sampling on the $\mathbb{S}^3$ hypersphere, given by the following
formula:
$$
\mathbf{q} = (\sqrt{1-u_1}\sin(2\pi u_2), \sqrt{1-u_1}\cos(2\pi u_2),
\sqrt{u_1}\sin(2\pi u_3), \sqrt{u_1}\cos(2\pi u_3))
$$
where the parameters $u_1, u_2, u_3 \in [0, 1]$, are drawn from a uniform distribution.</p><h1 id=library-implementations>Library implementations</h1><ul><li><p><code>Rotation.random</code> from <a class=link href=https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.random.html target=_blank rel=noopener>scipy</a>.</p><ul><li><a class=link href=https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.special_ortho_group.html#scipy.stats.special_ortho_group target=_blank rel=noopener>Uniform sampling in SO(n)</a></li></ul></li><li><p><a class=link href=https://eigen.tuxfamily.org/dox/classEigen_1_1Quaternion.html#a7da87cda5567ff1e860782d638643868 target=_blank rel=noopener>Eigen::Quaternion::UnitRandom</a></p></li><li><p><a class=link href=https://github.com/strasdat/Sophus/blob/d0b7315a0d90fc6143defa54596a3a95d9fa10ec/sophus/so3.hpp#L855 target=_blank rel=noopener>Sophus::SO3::sampleUniform</a></p></li></ul><h1 id=related-problem-uniform-sampling-inside-unit-ball>Related problem: Uniform sampling inside unit ball</h1><p>A related, but not equivalent problem is sampling inside the unit ball.</p><p>Reject sampling in a bounding cube should work for lower dimensions. In high dimensions where most volume is concentrated in the reject region, rejection rate is too high for it to be useful.</p><p>An approach without relying on rejection is to generate a random direction (which we already covered),
then normalize the radius parameter.</p><p>For the n-dimensional unit ball, the direction is given by sampling on its surface, i.e. $\mathbb{S}^{n-1}$. The radius is drawn from the uniform distribution $U \in [0, 1]$, then normalized to account for the volume element, that is: $r = U^{1/n}$.</p><h1 id=references>References</h1><ol><li><p>Sim, Robert, and Gregory Dudek. &ldquo;Learning generative models of scene features.&rdquo; International Journal of Computer Vision 60 (2004): 45-61.</p></li><li><p>Alexa, Marc. &ldquo;Super-fibonacci spirals: Fast, low-discrepancy sampling of so (3).&rdquo; Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition. 2022.</p></li><li><p><a class=link href=https://mathworld.wolfram.com/HyperspherePointPicking.html target=_blank rel=noopener>https://mathworld.wolfram.com/HyperspherePointPicking.html</a></p></li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/geometry/>Geometry</a>
<a href=/tags/math/>Math</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Kya's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>